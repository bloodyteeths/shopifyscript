import{a as T}from"/assets/_shared/chunk-XT2LVRN2.js";import{c as v,f as w,h as x,i as P,m as S}from"/assets/_shared/chunk-XSX5DAMU.js";import{a as A,b as _}from"/assets/_shared/chunk-E6CPWDOJ.js";import{c as f}from"/assets/_shared/chunk-F3TRQT5X.js";var i=f(A()),L=f(T());var t=f(_());function $(){let l=S(),[s]=w(),b=v(),g=l?.rows||[],[m,c]=i.useState("");i.useEffect(()=>{if(m){let e=setTimeout(()=>c(""),3e3);return()=>clearTimeout(e)}},[m]);let k=i.useCallback(async e=>{if(!(o||!Array.isArray(e)||e.length===0)){u(!0);try{let{backendFetch:a}=await import("/assets/_shared/hmac-IRSAAKZ4.js"),r=e.filter(h=>typeof h=="string"&&h.trim()).map(h=>({type:"add_exact_negative",target:h}));if(r.length===0){c("No valid terms to process");return}let n=await a("/insights/actions/apply","POST",{nonce:Date.now(),actions:r}),p=n?.json?.ok,y=n?.json?.applied?.length||0,F=n?.json?.skipped?.length||0;c(p?`Applied ${y}, skipped ${F}`:"Failed to add negatives")}catch(a){console.error("Error applying negatives:",a),c("Failed to add negatives - network error")}finally{u(!1)}}},[o]),R=i.useCallback(async e=>{if(!(o||!e||typeof e!="string")){u(!0);try{let{backendFetch:a}=await import("/assets/_shared/hmac-IRSAAKZ4.js"),r=await a("/insights/actions/apply","POST",{nonce:Date.now(),actions:[{type:"remove_exact_negative",target:e.trim()}]}),n=r?.json?.ok,p=r?.json?.applied?.length||0,y=r?.json?.skipped?.length||0;c(n?`Applied ${p}, skipped ${y}`:"Failed to remove")}catch(a){console.error("Error removing negative:",a),c("Failed to remove - network error")}finally{u(!1)}}},[o]),d=i.useRef(new Set),[o,u]=i.useState(!1),C=`/app/insights/terms.csv?${new URLSearchParams(Array.from(s.entries())).toString()}`;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,t.jsx)("span",{children:"Search Terms Explorer"}),(0,t.jsx)(x,{to:"/app/insights",children:"\u2190 Back to Insights"})]}),(0,t.jsxs)(P,{method:"get",style:{display:"grid",gridTemplateColumns:"repeat(6,minmax(0,1fr))",gap:8,margin:"12px 0"},children:[(0,t.jsx)("input",{name:"q",placeholder:"term contains\u2026",defaultValue:s.get("q")||""}),(0,t.jsx)("input",{name:"campaign",placeholder:"campaign contains\u2026",defaultValue:s.get("campaign")||""}),(0,t.jsxs)("select",{name:"w",defaultValue:s.get("w")||"7d",children:[(0,t.jsx)("option",{value:"24h",children:"24h"}),(0,t.jsx)("option",{value:"7d",children:"7d"}),(0,t.jsx)("option",{value:"30d",children:"30d"})]}),(0,t.jsx)("input",{name:"min_clicks",type:"number",step:"1",min:"0",defaultValue:s.get("min_clicks")||"0"}),(0,t.jsx)("input",{name:"min_cost",type:"number",step:"0.01",min:"0",defaultValue:s.get("min_cost")||"0"}),(0,t.jsx)("button",{type:"submit",disabled:b.state!=="idle",children:"Filter"})]}),(0,t.jsxs)("div",{style:{margin:"8px 0",display:"flex",gap:8,alignItems:"center"},children:[(0,t.jsx)("button",{onClick:()=>{let e=g.filter(a=>a&&!a.is_negative&&d.current.has(a.term)).map(a=>a.term);return k(e)},disabled:b.state!=="idle"||o,children:o?"Processing...":"Add exact negative (selected)"}),(0,t.jsx)("a",{href:C,children:(0,t.jsx)("button",{type:"button",children:"Export CSV (current filters)"})}),!!m&&(0,t.jsx)("span",{role:"status",style:{fontSize:12,opacity:.8},children:m})]}),(0,t.jsxs)("table",{cellPadding:6,style:{width:"100%",borderCollapse:"collapse"},children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:(0,t.jsx)("input",{type:"checkbox",onChange:e=>{e.currentTarget.checked?g.forEach(a=>d.current.add(a.term)):d.current.clear()}})}),["term","clicks","cost","conversions","cpc","cpa"].map(e=>{let a=(s.get("sort")||"cost")===e,r=a&&(s.get("dir")||"desc")==="desc"?"asc":"desc",n=new URLSearchParams(Array.from(s.entries()));return n.set("sort",e),n.set("dir",r),n.set("page","1"),(0,t.jsx)("th",{align:e==="term"?"left":"right",children:(0,t.jsxs)("a",{href:`?${n.toString()}`,style:{textDecoration:"none"},children:[e.toUpperCase(),a?s.get("dir")==="asc"?" \u25B2":" \u25BC":""]})},e)}),(0,t.jsx)("th",{align:"right",children:"Action"})]})}),(0,t.jsxs)("tbody",{children:[g.map(e=>!e||typeof e!="object"||!e.term?null:(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsx)("input",{type:"checkbox",disabled:e.is_negative,onChange:a=>{a.currentTarget.checked?d.current.add(e.term):d.current.delete(e.term)}})}),(0,t.jsxs)("td",{children:[e.term,e.is_negative&&(0,t.jsx)("span",{style:{marginLeft:6,fontSize:10,padding:"2px 6px",border:"1px solid #eee",borderRadius:6},children:"NEGATIVE"})]}),(0,t.jsx)("td",{align:"right",children:e.clicks}),(0,t.jsxs)("td",{align:"right",children:["$",Number(e.cost||0).toFixed(2)]}),(0,t.jsx)("td",{align:"right",children:e.conversions}),(0,t.jsxs)("td",{align:"right",children:["$",Number(e.cpc||0).toFixed(2)]}),(0,t.jsxs)("td",{align:"right",children:["$",Number(e.cpa||0).toFixed(2)]}),(0,t.jsx)("td",{align:"right",children:e.is_negative?(0,t.jsx)("button",{onClick:()=>R(e.term),disabled:o,children:o?"Processing...":"Remove"}):(0,t.jsx)("button",{onClick:()=>k([e.term]),disabled:o,children:o?"Processing...":"Add exact negative"})})]},`row-${e.term}-${e.clicks||0}`)),!g.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:8,children:"No rows match your filters."})})]})]}),(0,t.jsx)("div",{style:{display:"flex",gap:12,alignItems:"center",marginTop:8},children:(()=>{let e=l?.total||0,a=l?.page||1,r=l?.pages||1,n=new URLSearchParams(Array.from(s.entries()));n.set("page",String(Math.max(1,a-1)));let p=new URLSearchParams(Array.from(s.entries()));return p.set("page",String(Math.min(r,a+1))),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("span",{children:[a," / ",r," (",e," rows)"]}),(0,t.jsx)("a",{href:`?${n.toString()}`,children:(0,t.jsx)("button",{disabled:a<=1,children:"Prev"})}),(0,t.jsx)("a",{href:`?${p.toString()}`,children:(0,t.jsx)("button",{disabled:a>=r,children:"Next"})})]})})()})]})}export{$ as default};
