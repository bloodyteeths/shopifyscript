import{b as a,c as m,d as r,e as $,f as w,g as c,h as D,i as Z,j as ee,k as G,l as A,m as b,n as te,o as ne,p as R,q as g,r as ae,s as j,t as M,u as H,v as oe}from"/assets/_shared/chunk-NF62UQ7G.js";import{a as Re}from"/assets/_shared/chunk-XT2LVRN2.js";import{m as X}from"/assets/_shared/chunk-XSX5DAMU.js";import{a as De,b as L}from"/assets/_shared/chunk-E6CPWDOJ.js";import{c as S}from"/assets/_shared/chunk-F3TRQT5X.js";var Ee=S(Re());var n=S(De());var e=S(L());var Fe=()=>(0,e.jsx)("span",{children:"\u270F\uFE0F"});var Ue=({tenantId:d,promoteEnabled:s=!1})=>{let[h,le]=(0,n.useState)(0),[T,y]=(0,n.useState)(!1),[Ne,$e]=(0,n.useState)(null),[ce,z]=(0,n.useState)(!1),[de,pe]=(0,n.useState)(""),[ue,ge]=(0,n.useState)(!1),[v,F]=(0,n.useState)({selector:"",channel:"web",metafields:{},description:""}),[ye,me]=(0,n.useState)([]),[U,fe]=(0,n.useState)(null),[ve,P]=(0,n.useState)(!1),[E,be]=(0,n.useState)({}),[he,C]=(0,n.useState)(!1),[i,p]=(0,n.useState)(null),[B,Ce]=(0,n.useState)(null),[J,Se]=(0,n.useState)("high-intent"),[_,V]=(0,n.useState)({}),[W,Te]=(0,n.useState)([]),[_e,x]=(0,n.useState)(!1),[u,I]=(0,n.useState)({campaign_name:"",offer_details:"",target_audience:"",industry:"ecommerce",campaign_type:"sale"}),l=(0,n.useCallback)((t,o=!1)=>{pe(t),ge(o),z(!0)},[]),f=(0,n.useCallback)(async(t,o={})=>{try{let k=await(await fetch(`/api/intent-os/${t}`,{headers:{"Content-Type":"application/json",...o.headers},...o})).json();if(!k.success)throw new Error(k.error||"API call failed");return k.data}catch(O){throw console.error(`API call failed: ${t}`,O),O}},[]);(0,n.useEffect)(()=>{q(),N(),K()},[d]);let q=async()=>{try{let t=await f(`intent-blocks?tenantId=${d}`);be(t||{})}catch(t){console.error("Failed to load intent blocks:",t)}},N=async()=>{try{let t=await f(`overlay-history?tenantId=${d}`);me(t||[]);let o=await f(`overlay-active?tenantId=${d}`);fe(o)}catch(t){console.error("Failed to load overlay history:",t)}},K=async()=>{try{let t=await f(`promo-drafts?tenantId=${d}`);Te(t||[])}catch(t){console.error("Failed to load promo drafts:",t)}},xe=async()=>{if(!s){l("PROMOTE flag must be enabled to apply overlays",!0);return}y(!0);try{await f("apply-overlay",{method:"POST",body:JSON.stringify({tenantId:d,overlayConfig:v,promote:!0})}),l("Metafield overlay applied successfully"),P(!1),N()}catch(t){l(`Failed to apply overlay: ${t.message}`,!0)}finally{y(!1)}},Y=async t=>{if(!s){l("PROMOTE flag must be enabled to revert overlays",!0);return}y(!0);try{await f("revert-overlay",{method:"POST",body:JSON.stringify({tenantId:d,targetVersion:t,promote:!0})}),l("Metafield overlay reverted successfully"),N()}catch(o){l(`Failed to revert overlay: ${o.message}`,!0)}finally{y(!1)}},Ie=async()=>{y(!0);try{let t=await f("utm-content",{method:"POST",body:JSON.stringify({tenantId:d,utmTerm:J,productContext:_})});Ce(t),l("UTM content generated successfully")}catch(t){l(`Failed to generate UTM content: ${t.message}`,!0)}finally{y(!1)}},Oe=async()=>{if(!i||!s){l("PROMOTE flag must be enabled to save intent blocks",!0);return}y(!0);try{await f("intent-blocks",{method:"POST",body:JSON.stringify({tenantId:d,intentKey:i.intent_key,blockData:i,promote:!0})}),l("Intent block saved successfully"),C(!1),p(null),q()}catch(t){l(`Failed to save intent block: ${t.message}`,!0)}finally{y(!1)}},ke=async()=>{if(!s){l("PROMOTE flag must be enabled to create promo drafts",!0);return}y(!0);try{let t=await f("promo-draft",{method:"POST",body:JSON.stringify({tenantId:d,promoConfig:u,promote:!0})});l(`Promo draft created: ${t.draft.title}`),x(!1),K()}catch(t){l(`Failed to create promo draft: ${t.message}`,!0)}finally{y(!1)}},Ae=[{id:"overlays",content:"Catalog Overlays",accessibilityLabel:"Metafield overlay management",panelID:"overlays-panel"},{id:"intent-blocks",content:"Intent Blocks",accessibilityLabel:"Intent block management",panelID:"intent-blocks-panel"},{id:"utm-content",content:"UTM Content",accessibilityLabel:"UTM-driven content generation",panelID:"utm-content-panel"},{id:"promo-drafts",content:"Promo Drafts",accessibilityLabel:"AI-generated promo page drafts",panelID:"promo-drafts-panel"}],Me=()=>(0,e.jsx)(g,{children:(0,e.jsxs)(g.Section,{children:[!s&&(0,e.jsx)(Z,{status:"warning",title:"PROMOTE flag disabled",children:(0,e.jsx)("p",{children:"Overlay mutations are disabled. Enable PROMOTE flag to apply changes."})}),(0,e.jsxs)(r,{children:[(0,e.jsx)(r.Section,{children:(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,e.jsx)(a,{variant:"headingMd",children:"Metafield Overlays"}),(0,e.jsx)(m,{primary:!0,onClick:()=>P(!0),disabled:!s,children:"Apply New Overlay"})]})}),U&&(0,e.jsx)(r.Section,{children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[(0,e.jsx)(a,{variant:"headingSm",children:"Active Overlay"}),(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,e.jsxs)(R,{children:[(0,e.jsxs)(a,{children:["Version: ",U.version]}),(0,e.jsxs)(a,{color:"subdued",children:["Applied:"," ",new Date(U.appliedAt).toLocaleString()]})]}),(0,e.jsx)(m,{destructive:!0,onClick:()=>Y(),disabled:!s,loading:T,children:"Revert to Previous"})]})]})}),(0,e.jsx)(r.Section,{children:(0,e.jsx)(ee,{columnContentTypes:["text","text","text","text","text"],headings:["Timestamp","Action","Selector","Channel","Actions"],rows:ye.map(t=>[new Date(t.timestamp).toLocaleString(),(0,e.jsx)(w,{status:t.action==="APPLY"?"success":"info",children:t.action}),t.selector||"-",t.channel||"web",(0,e.jsx)(D,{children:(0,e.jsx)(m,{size:"slim",onClick:()=>Y(t.timestamp),disabled:!s,children:"Revert to This"})})])})})]})]})}),Pe=()=>(0,e.jsx)(g,{children:(0,e.jsx)(g.Section,{children:(0,e.jsxs)(r,{children:[(0,e.jsx)(r.Section,{children:(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,e.jsx)(a,{variant:"headingMd",children:"Intent Blocks"}),(0,e.jsx)(m,{primary:!0,onClick:()=>{p({intent_key:"",hero_headline:"",benefit_bullets:[],proof_snippet:"",cta_text:"",url_target:"",updated_at:"",updated_by:""}),C(!0)},disabled:!s,children:"Create Intent Block"})]})}),(0,e.jsx)(r.Section,{children:Object.keys(E).length===0?(0,e.jsx)(G,{heading:"No intent blocks yet",action:{content:"Create your first intent block",onAction:()=>{p({intent_key:"",hero_headline:"",benefit_bullets:[],proof_snippet:"",cta_text:"",url_target:"",updated_at:"",updated_by:""}),C(!0)}},image:"https://cdn.shopify.com/s/files/1/0005/4175/0643/files/empty-state.svg",children:(0,e.jsx)("p",{children:"Intent blocks help you create targeted content for different user intents and UTM campaigns."})}):(0,e.jsx)(H,{resourceName:{singular:"intent block",plural:"intent blocks"},items:Object.entries(E).map(([t,o])=>({id:t,...o})),renderItem:t=>{let{id:o,hero_headline:O,proof_snippet:k,updated_at:Q}=t;return(0,e.jsx)(j,{id:o,media:(0,e.jsx)($,{customer:!1,size:"medium",initials:o.substring(0,2).toUpperCase()}),accessibilityLabel:`View details for ${o}`,children:(0,e.jsxs)("div",{distribution:"fillEvenly",children:[(0,e.jsxs)("div",{vertical:!0,spacing:"extraTight",children:[(0,e.jsx)(a,{variant:"bodyMd",fontWeight:"semibold",children:o}),(0,e.jsx)(a,{variant:"bodySm",children:O}),(0,e.jsx)(a,{variant:"bodySm",color:"subdued",children:k}),(0,e.jsxs)(a,{variant:"bodySm",color:"subdued",children:["Updated:"," ",Q?new Date(Q).toLocaleString():"Never"]})]}),(0,e.jsx)(D,{children:(0,e.jsx)(m,{icon:Fe,size:"slim",onClick:()=>{p(E[o]),C(!0)},disabled:!s,children:"Edit"})})]})})}})})]})})}),Be=()=>(0,e.jsx)(g,{children:(0,e.jsx)(g.Section,{children:(0,e.jsxs)(r,{children:[(0,e.jsxs)(r.Section,{children:[(0,e.jsx)(a,{variant:"headingMd",children:"UTM-Driven Content Generator"}),(0,e.jsx)(R,{children:(0,e.jsx)("p",{children:"Generate dynamic content variations based on UTM parameters for improved conversion rates."})})]}),(0,e.jsx)(r.Section,{children:(0,e.jsxs)(A,{children:[(0,e.jsx)(M,{label:"UTM Term",options:[{label:"High Intent",value:"high-intent"},{label:"Research Phase",value:"research"},{label:"Comparison Shopping",value:"comparison"}],value:J,onChange:t=>Se(t)}),(0,e.jsx)(c,{label:"Product Category",value:_.category||"",onChange:t=>V({..._,category:t}),placeholder:"e.g., shoes, electronics, furniture"}),(0,e.jsx)(c,{label:"Discount Percentage",value:_.discount||"",onChange:t=>V({..._,discount:t}),placeholder:"e.g., 20",suffix:"%"}),(0,e.jsx)(m,{primary:!0,onClick:Ie,loading:T,children:"Generate Content Variations"})]})}),B&&(0,e.jsx)(r.Section,{children:(0,e.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[(0,e.jsx)(a,{variant:"headingSm",children:"Generated Content"}),(0,e.jsxs)(a,{color:"subdued",children:["Strategy: ",B.strategy.urgency," urgency,"," ",B.strategy.social_proof," social proof"]}),B.variations.map((t,o)=>(0,e.jsx)(r,{sectioned:!0,children:(0,e.jsxs)("div",{vertical:!0,spacing:"tight",children:[(0,e.jsxs)(a,{variant:"headingSm",children:["Variation ",o+1]}),(0,e.jsxs)(a,{children:[(0,e.jsx)("strong",{children:"Headline:"})," ",t.hero_headline]}),(0,e.jsxs)(a,{children:[(0,e.jsx)("strong",{children:"Benefits:"})," ",t.benefit_bullets.join(" \u2022 ")]}),(0,e.jsxs)(a,{children:[(0,e.jsx)("strong",{children:"Social Proof:"})," ",t.proof_snippet]}),(0,e.jsxs)(a,{children:[(0,e.jsx)("strong",{children:"CTA:"})," ",t.cta_text]}),(0,e.jsxs)(a,{children:[(0,e.jsx)("strong",{children:"URL:"})," ",t.url_target]})]})},o))]})})]})})}),Le=()=>(0,e.jsx)(g,{children:(0,e.jsx)(g.Section,{children:(0,e.jsxs)(r,{children:[(0,e.jsxs)(r.Section,{children:[(0,e.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,e.jsx)(a,{variant:"headingMd",children:"AI Promo Page Drafts"}),(0,e.jsx)(m,{primary:!0,onClick:()=>x(!0),disabled:!s,children:"Create Promo Draft"})]}),(0,e.jsx)(R,{children:(0,e.jsx)("p",{children:"AI-generated promotional page drafts. All pages remain as drafts and require manual review before publishing."})})]}),(0,e.jsx)(r.Section,{children:W.length===0?(0,e.jsx)(G,{heading:"No promo drafts yet",action:{content:"Create your first promo draft",onAction:()=>x(!0)},image:"https://cdn.shopify.com/s/files/1/0005/4175/0643/files/empty-state.svg",children:(0,e.jsx)("p",{children:"Generate AI-powered promotional page drafts for your campaigns and offers."})}):(0,e.jsx)(H,{resourceName:{singular:"promo draft",plural:"promo drafts"},items:W,renderItem:t=>(0,e.jsx)(j,{id:t.id,media:(0,e.jsx)($,{customer:!1,size:"medium",initials:"PD"}),accessibilityLabel:`View details for ${t.title}`,children:(0,e.jsxs)("div",{distribution:"fillEvenly",children:[(0,e.jsxs)("div",{vertical:!0,spacing:"extraTight",children:[(0,e.jsx)(a,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),(0,e.jsx)(a,{variant:"bodySm",children:t.meta_description}),(0,e.jsxs)(a,{variant:"bodySm",color:"subdued",children:["Handle: /",t.handle]}),(0,e.jsxs)(a,{variant:"bodySm",color:"subdued",children:["Created: ",new Date(t.created_at).toLocaleString()]}),(0,e.jsxs)("div",{spacing:"extraTight",children:[(0,e.jsx)(w,{status:"info",children:"DRAFT"}),t.tags.map(o=>(0,e.jsx)(w,{children:o},o))]})]}),(0,e.jsxs)(D,{children:[(0,e.jsx)(m,{size:"slim",children:"Preview"}),(0,e.jsx)(m,{size:"slim",primary:!0,children:"Review & Publish"})]})]})})})})]})})}),we=ce?(0,e.jsx)(oe,{content:de,error:ue,onDismiss:()=>z(!1)}):null;return(0,e.jsxs)(te,{children:[(0,e.jsxs)(ae,{title:"Intent OS - Conversion Rate Optimization",children:[(0,e.jsx)(g,{children:(0,e.jsx)(g.Section,{children:(0,e.jsx)(r,{children:(0,e.jsx)(ne,{tabs:Ae,selected:h,onSelect:le,children:(0,e.jsxs)(r.Section,{children:[h===0&&Me(),h===1&&Pe(),h===2&&Be(),h===3&&Le()]})})})})}),(0,e.jsx)(b,{open:ve,onClose:()=>P(!1),title:"Apply Metafield Overlay",primaryAction:{content:"Apply Overlay",onAction:xe,loading:T,disabled:!s},secondaryActions:[{content:"Cancel",onAction:()=>P(!1)}],children:(0,e.jsx)(b.Section,{children:(0,e.jsxs)(A,{children:[(0,e.jsx)(c,{label:"CSS Selector",value:v.selector,onChange:t=>F({...v,selector:t}),placeholder:"e.g., .product-title, #price-display",helpText:"Target element for the overlay"}),(0,e.jsx)(M,{label:"Channel",options:[{label:"Web",value:"web"},{label:"Mobile App",value:"mobile"},{label:"Email",value:"email"}],value:v.channel,onChange:t=>F({...v,channel:t})}),(0,e.jsx)(c,{label:"Description",value:v.description||"",onChange:t=>F({...v,description:t}),placeholder:"Brief description of this overlay",multiline:2})]})})}),(0,e.jsx)(b,{open:he,onClose:()=>{C(!1),p(null)},title:i?.intent_key?"Edit Intent Block":"Create Intent Block",primaryAction:{content:"Save Intent Block",onAction:Oe,loading:T,disabled:!s},secondaryActions:[{content:"Cancel",onAction:()=>{C(!1),p(null)}}],children:i&&(0,e.jsx)(b.Section,{children:(0,e.jsxs)(A,{children:[(0,e.jsx)(c,{label:"Intent Key",value:i.intent_key,onChange:t=>p({...i,intent_key:t}),placeholder:"e.g., high-intent-sale, brand-awareness"}),(0,e.jsx)(c,{label:"Hero Headline",value:i.hero_headline,onChange:t=>p({...i,hero_headline:t}),placeholder:"Compelling headline for this intent"}),(0,e.jsx)(c,{label:"Benefit Bullets (one per line)",value:i.benefit_bullets.join(`
`),onChange:t=>p({...i,benefit_bullets:t.split(`
`).filter(Boolean)}),multiline:4,placeholder:`Fast Shipping
Money-Back Guarantee
Expert Support`}),(0,e.jsx)(c,{label:"Social Proof Snippet",value:i.proof_snippet,onChange:t=>p({...i,proof_snippet:t}),placeholder:"Join 10,000+ satisfied customers"}),(0,e.jsx)(c,{label:"CTA Text",value:i.cta_text,onChange:t=>p({...i,cta_text:t}),placeholder:"Shop Now & Save"}),(0,e.jsx)(c,{label:"Target URL",value:i.url_target,onChange:t=>p({...i,url_target:t}),placeholder:"/collections/sale"})]})})}),(0,e.jsx)(b,{open:_e,onClose:()=>x(!1),title:"Create AI Promo Draft",primaryAction:{content:"Generate Draft",onAction:ke,loading:T,disabled:!s},secondaryActions:[{content:"Cancel",onAction:()=>x(!1)}],children:(0,e.jsx)(b.Section,{children:(0,e.jsxs)(A,{children:[(0,e.jsx)(c,{label:"Campaign Name",value:u.campaign_name,onChange:t=>I({...u,campaign_name:t}),placeholder:"Summer Sale 2024"}),(0,e.jsx)(c,{label:"Offer Details",value:u.offer_details,onChange:t=>I({...u,offer_details:t}),placeholder:"25% off all summer items + free shipping",multiline:2}),(0,e.jsx)(c,{label:"Target Audience",value:u.target_audience,onChange:t=>I({...u,target_audience:t}),placeholder:"Fashion-conscious millennials"}),(0,e.jsx)(M,{label:"Industry",options:[{label:"E-commerce",value:"ecommerce"},{label:"SaaS",value:"saas"},{label:"Services",value:"services"}],value:u.industry,onChange:t=>I({...u,industry:t})}),(0,e.jsx)(M,{label:"Campaign Type",options:[{label:"Sale/Discount",value:"sale"},{label:"Product Launch",value:"launch"},{label:"Seasonal",value:"seasonal"},{label:"Flash Sale",value:"flash"}],value:u.campaign_type,onChange:t=>I({...u,campaign_type:t})})]})})})]}),we]})},re=Ue;var se=S(L());function ie(){let{tenantId:d,promoteEnabled:s,shopDomain:h}=X();return(0,se.jsx)(re,{tenantId:d,promoteEnabled:s})}export{ie as default};
